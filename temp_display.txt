import React, { useMemo, useState, useEffect, useRef } from "react";

// Generic wireframe for policy pages (Privacy, Terms, Cookie, Refunds)
// EN only. UK-first, EU-second. No header/footer here вЂ” assumed reusable.

type Region = "UK" | "EU";

type Section = { id: string; title: string; body?: string };

type Policy = {
  id: "privacy" | "terms" | "cookie" | "refunds";
  name: string;
  sections: Section[];
};

const POLICIES: Policy[] = [
  {
    id: "privacy",
    name: "Privacy Policy",
    sections: [
      { id: "intro", title: "Introduction", body: "How we collect, use, and protect personal data." },
      { id: "scope", title: "Scope & Region", body: "This policy applies to users in the UK and EU/EEA." },
      { id: "data", title: "Data We Collect", body: "Account, billing, product usage, and support data." },
      { id: "use", title: "How We Use Data", body: "Provide the service, billing, analytics, support, and security." },
      { id: "legal", title: "Legal Bases (EU/UK)", body: "Contract, legitimate interests, consent, legal obligation." },
      { id: "rights", title: "Your Rights", body: "Access, rectify, erase, restrict, portability, object." },
      { id: "security", title: "Security", body: "Administrative, technical, and organizational measures." },
      { id: "retention", title: "Retention", body: "We keep data only as long as necessary for stated purposes." },
      { id: "sharing", title: "Sharing & Processors", body: "We use carefully selected subвЂ‘processors for core features." },
      { id: "cookies", title: "Cookies", body: "See Cookie Policy for details; manage preferences in app." },
      { id: "contact", title: "Contact", body: "GET STUFFED LTD (Company number 15673179)\nEmail: info@invoicerly.co.uk\nPostal: Flat 21 County Chambers, 1 Drapery, Northampton, United Kingdom, NN1 2ET\nWe reply within one business day." },
    ],
  },
  {
    id: "terms",
    name: "Terms of Service",
    sections: [
      { id: "intro", title: "Introduction", body: "Your agreement with us to use the service." },
      { id: "eligibility", title: "Eligibility & Account", body: "You must provide accurate information and keep credentials secure." },
      { id: "use", title: "Acceptable Use", body: "No illegal, harmful, or abusive behavior; respect IP rights." },
      { id: "billing", title: "Billing & Taxes", body: "Subscriptions, trials, renewals, and VAT invoicing." },
      { id: "cancellation", title: "Cancellation & Termination", body: "How to cancel and what happens to data." },
      { id: "liability", title: "Limitation of Liability", body: "The service is provided asвЂ‘is within lawful limits." },
      { id: "law", title: "Governing Law", body: "As per region (UK/EU) shown above." },
      { id: "contact", title: "Contact", body: "GET STUFFED LTD (Company number 15673179)\nEmail: info@invoicerly.co.uk\nPostal: Flat 21 County Chambers, 1 Drapery, Northampton, United Kingdom, NN1 2ET\nWe respond within one business day." },
    ],
  },
  {
    id: "cookie",
    name: "Cookie Policy",
    sections: [
      { id: "intro", title: "Introduction", body: "What cookies are and why we use them." },
      { id: "types", title: "Types of Cookies", body: "Strictly necessary, performance, functionality, targeting." },
      { id: "prefs", title: "Managing Preferences", body: "Change consent in app settings or browser controls." },
      { id: "duration", title: "Duration", body: "Session vs persistent lifetimes." },
      { id: "contact", title: "Contact", body: "Email: info@invoicerly.co.uk\nPostal: Flat 21 County Chambers, 1 Drapery, Northampton, United Kingdom, NN1 2ET" },
    ],
  },
  {
    id: "refunds",
    name: "Refund & Cancellation Policy",
    sections: [
      { id: "intro", title: "Introduction", body: "How refunds and cancellations work." },
      { id: "trials", title: "Trials & Renewals", body: "Trials, autoвЂ‘renewal, and how to turn off renewal." },
      { id: "refunds", title: "Refunds", body: "When we refund and how long processing takes." },
      { id: "eu_rights", title: "EU/UK Consumer Rights", body: "Statutory rights and exceptions for digital services." },
      { id: "contact", title: "Contact", body: "Email: info@invoicerly.co.uk\nPostal: Flat 21 County Chambers, 1 Drapery, Northampton, United Kingdom, NN1 2ET" },
    ],
  },
];

function SectionWrap({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return <section className={`max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 ${className}`}>{children}</section>;
}

function Card({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return <div className={`rounded-2xl bg-white border border-black/10 shadow-sm ${className}`}>{children}</div>;
}

function Pill({ children }: { children: React.ReactNode }) {
  return <span className="inline-flex items-center rounded-full border border-black/10 bg-white/70 px-2 py-0.5 text-[11px]">{children}</span>;
}

function Button({ children, onClick, kind = "primary" }: { children: React.ReactNode; onClick?: ()=>void; kind?: "primary"|"ghost" }) {
  const base = "rounded-xl px-4 py-2 text-sm font-medium";
  const styles = kind === 'primary' ? "bg-blue-600 hover:bg-blue-700 text-white" : "border border-black/10 bg-white";
  return <button onClick={onClick} className={`${base} ${styles}`}>{children}</button>;
}

function useHeadings(sections: Section[]) {
  return useMemo(() => sections.map(s => ({ id: s.id, title: s.title })), [sections]);
}

function Toc({ headings, current, onJump }: { headings: {id:string; title:string}[]; current?: string; onJump: (id:string)=>void }) {
  return (
    <nav className="sticky top-20 text-sm">
      <div className="mb-2 text-xs uppercase tracking-wide text-slate-500">On this page</div>
      <ul className="space-y-1">
        {headings.map(h => (
          <li key={h.id}>
            <button onClick={()=>onJump(h.id)} className={`text-left hover:underline ${current===h.id? 'font-medium text-slate-900':'text-slate-700'}`}>{h.title}</button>
          </li>
        ))}
      </ul>
    </nav>
  );
}

function MetaRow({ label, value }: { label: string; value: string }) {
  return <div className="flex items-center justify-between text-sm"><div className="text-slate-600">{label}</div><div className="font-medium">{value}</div></div>;
}

export default function PoliciesPage() {
  const [region, setRegion] = useState<Region>('UK');
  const [policyId, setPolicyId] = useState<Policy['id']>('privacy');
  const policy = POLICIES.find(p => p.id === policyId)!;
  const headings = useHeadings(policy.sections);
  const [active, setActive] = useState<string>(headings[0]?.id || '');
  const contentRef = useRef<HTMLDivElement>(null);

  useEffect(()=>{ setActive(headings[0]?.id || ''); }, [policyId]);

  const lawText = region === 'UK' ? 'United Kingdom law (courts of England & Wales)' : 'EU/EEA law (for example, Ireland)';
  const effectiveDate = '01 Sep 2025';
  const lastUpdated = '02 Sep 2025';
  const version = 'v0.1-draft';

  const onJump = (id: string) => {
    const el = document.getElementById(id);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    setActive(id);
  };

  return (
    <main className="bg-slate-50 min-h-screen">
      <SectionWrap className="py-10">
        <div className="text-center">
          <div className="inline-flex items-center gap-2"><Pill>UKвЂ‘first</Pill><Pill>EUвЂ‘ready</Pill><Pill>English only</Pill></div>
          <h1 className="mt-4 text-4xl sm:text-5xl font-bold text-slate-900">{policy.name}</h1>
          <p className="mt-3 text-slate-600 text-lg">This page outlines our {policy.name.toLowerCase()} for the {region} region.</p>
          <div className="mt-6 flex flex-wrap items-center justify-center gap-3">
            <div className="inline-flex rounded-xl border border-black/10 bg-white p-1">
              {(['privacy','terms','cookie','refunds'] as Policy['id'][]).map(pid => (
                <button key={pid} onClick={()=>setPolicyId(pid)} className={`px-3 py-1.5 text-sm rounded-lg ${policyId===pid? 'bg-slate-900 text-white':'text-slate-700 hover:bg-slate-100'}`}>{POLICIES.find(p=>p.id===pid)?.name.split(' ')[0]}</button>
              ))}
            </div>
            <div className="inline-flex rounded-xl border border-black/10 bg-white p-1">
              {(['UK','EU'] as Region[]).map(r => (
                <button key={r} onClick={()=>setRegion(r)} className={`px-3 py-1.5 text-sm rounded-lg ${region===r? 'bg-slate-900 text-white':'text-slate-700 hover:bg-slate-100'}`}>{r}</button>
              ))}
            </div>
            <Button kind="ghost">Download PDF</Button>
            <Button kind="ghost" onClick={()=>window.print()}>Print</Button>
          </div>
        </div>

        <div className="mt-10 grid lg:grid-cols-[220px,1fr,260px] gap-6 items-start">
          <div className="hidden lg:block">
            <Card className="p-4">
              <Toc headings={headings} current={active} onJump={onJump} />
            </Card>
          </div>

          <div>
            <Card className="p-6" >
              <div className="grid sm:grid-cols-3 gap-4 text-sm">
                <MetaRow label="Effective" value={effectiveDate} />
                <MetaRow label="Last updated" value={lastUpdated} />
                <MetaRow label="Version" value={version} />
              </div>
              <div className="mt-3 text-xs text-slate-600">Governing law: {lawText} вЂў Questions: <a className="underline" href="mailto:info@invoicerly.co.uk">info@invoicerly.co.uk</a> • GET STUFFED LTD (Company number 15673179)</div>
            </Card>

            <Card className="mt-6 p-6" ref={contentRef as any}>
              {policy.sections.map((s) => (
                <section key={s.id} id={s.id} className="scroll-mt-24">
                  <h2 className="text-xl font-semibold mt-6 first:mt-0">{s.title}</h2>
                  <p className="mt-2 text-slate-700 text-sm">{s.body || 'Content placeholder. Replace with your policy copy.'}</p>
                </section>
              ))}
            </Card>
          </div>

          <div>
            <Card className="p-6">
              <h3 className="text-base font-semibold">Need help?</h3>
              <p className="text-slate-600 text-sm mt-1">Email <a className="underline" href="mailto:info@invoicerly.co.uk">info@invoicerly.co.uk</a> and weвЂ™ll get back to you.
GET STUFFED LTD · Company number 15673179 · Flat 21 County Chambers, 1 Drapery, Northampton, United Kingdom, NN1 2ET</p>
              <div className="mt-4 h-px bg-black/10"></div>
              <h4 className="text-sm font-medium mt-4">Change log</h4>
              <ul className="mt-2 text-sm text-slate-700 space-y-2">
                <li><span className="text-slate-500">02 Sep 2025 вЂ”</span> Draft structure updated for UK/EU.</li>
                <li><span className="text-slate-500">01 Sep 2025 вЂ”</span> Initial draft created.</li>
              </ul>
            </Card>
          </div>
        </div>

        <div className="mt-10 text-center text-xs text-slate-500">This is a wireframe. Replace placeholders with your legal text before publishing.</div>
      </SectionWrap>
    </main>
  );
}
